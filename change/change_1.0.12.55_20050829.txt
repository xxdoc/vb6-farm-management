
CREATE TABLE CAPITAL_LOSS 
(
   CAPITAL_LOSS_ID        ID_TYPE NOT NULL,
   DOCUMENT_NO            CODE_TYPE,
   DOCUMENT_DATE          DATE_TYPE,
   IVD_ID                 ID_TYPE,
   BL_ID                  ID_TYPE,
   DOCUMENT_CATEGORY      ID_TYPE,
   DOCUMENT_TYPE          ID_TYPE,
   TX_AMOUNT              MONEY_TYPE,
   TX_TYPE                CODE_TYPE,
   FROM_HOUSE_ID          ID_TYPE,
   TO_HOUSE_ID            ID_TYPE,
   PIG_STATUS             ID_TYPE,
   IMPORT_ITEM_ID         ID_TYPE,
   EXPORT_ITEM_ID         ID_TYPE,
   PIG_ID                 ID_TYPE,
   COMMIT_FLAG            FLAG_TYPE,
   TX_SEQ                 ID_TYPE,
   TO_PIG_COUNT           MONEY_TYPE,
   REPLACE_FLAG           FLAG_TYPE,
   BILLING_DOC_ID         ID_TYPE,
   TO_PIG_ID              ID_TYPE,

   CREATE_DATE            DATE_TYPE NOT NULL,
   CREATE_BY              ID_TYPE NOT NULL,
   MODIFY_DATE            DATE_TYPE NOT NULL,
   MODIFY_BY              ID_TYPE NOT NULL
);

ALTER TABLE CAPITAL_LOSS ADD CONSTRAINT CAPITAL_LOSS_ID_PK PRIMARY KEY (CAPITAL_LOSS_ID);
ALTER TABLE CAPITAL_LOSS ADD CONSTRAINT CAPITAL_LOSS_BLD_FK1 FOREIGN KEY (BL_ID) REFERENCES BILLING_DOC (BILLING_DOC_ID);
ALTER TABLE CAPITAL_LOSS ADD CONSTRAINT CAPITAL_LOSS_DOC_ID_FK1 FOREIGN KEY (BILLING_DOC_ID) REFERENCES BILLING_DOC (BILLING_DOC_ID);
ALTER TABLE CAPITAL_LOSS ADD CONSTRAINT CAPITAL_LOSS_EXP_FK1 FOREIGN KEY (EXPORT_ITEM_ID) REFERENCES EXPORT_ITEM (EXPORT_ITEM_ID);
ALTER TABLE CAPITAL_LOSS ADD CONSTRAINT CAPITAL_LOSS_HOUSE_FK1 FOREIGN KEY (FROM_HOUSE_ID) REFERENCES LOCATION (LOCATION_ID);
ALTER TABLE CAPITAL_LOSS ADD CONSTRAINT CAPITAL_LOSS_HOUSE_FK2 FOREIGN KEY (TO_HOUSE_ID) REFERENCES LOCATION (LOCATION_ID);
ALTER TABLE CAPITAL_LOSS ADD CONSTRAINT CAPITAL_LOSS_IMP_FK1 FOREIGN KEY (IMPORT_ITEM_ID) REFERENCES IMPORT_ITEM (IMPORT_ITEM_ID);
ALTER TABLE CAPITAL_LOSS ADD CONSTRAINT CAPITAL_LOSS_IVD_FK1 FOREIGN KEY (IVD_ID) REFERENCES INVENTORY_DOC (INVENTORY_DOC_ID);
ALTER TABLE CAPITAL_LOSS ADD CONSTRAINT CAPITAL_LOSS_PIG_FK1 FOREIGN KEY (PIG_ID) REFERENCES PART_ITEM (PART_ITEM_ID);
ALTER TABLE CAPITAL_LOSS ADD CONSTRAINT CAPITAL_LOSS_STATUS_FK1 FOREIGN KEY (PIG_STATUS) REFERENCES PRODUCT_STATUS (PRODUCT_STATUS_ID);
ALTER TABLE CAPITAL_LOSS ADD CONSTRAINT CAPITAL_LOSS_TO_PIG_FK FOREIGN KEY (TO_PIG_ID) REFERENCES PART_ITEM (PART_ITEM_ID);

CREATE GENERATOR CAPITAL_LOSS_SEQ;

CREATE TABLE LOSS_ITEM
(
   LOSS_ITEM_ID          ID_TYPE NOT NULL,
   CAPITAL_LOSS_ID       ID_TYPE NOT NULL,
   EXPENSE_TYPE          ID_TYPE,
   PART_ITEM_ID          ID_TYPE,
   CAPITAL_AMOUNT        MONEY_TYPE,

   CREATE_DATE           DATE_TYPE NOT NULL,
   CREATE_BY             ID_TYPE NOT NULL,
   MODIFY_DATE           DATE_TYPE NOT NULL,
   MODIFY_BY             ID_TYPE NOT NULL
);

ALTER TABLE LOSS_ITEM ADD CONSTRAINT LOSS_ITEM_ID_PK PRIMARY KEY (LOSS_ITEM_ID);
ALTER TABLE LOSS_ITEM ADD CONSTRAINT LOSS_ITEM_CPM_ID_FK FOREIGN KEY (CAPITAL_LOSS_ID) REFERENCES CAPITAL_LOSS (CAPITAL_LOSS_ID);
ALTER TABLE LOSS_ITEM ADD CONSTRAINT LOSS_ITEM_EXPENSE_ID_FK FOREIGN KEY (EXPENSE_TYPE) REFERENCES EXPENSE_TYPE (EXPENSE_TYPE_ID);
ALTER TABLE LOSS_ITEM ADD CONSTRAINT LOSS_ITEM_PRTITM_ID_FK FOREIGN KEY (PART_ITEM_ID) REFERENCES PART_ITEM (PART_ITEM_ID);

CREATE GENERATOR LOSS_ITEM_SEQ;

UPDATE DOCUMENT_PRIORITY SET PRIORITY1 = PRIORITY1 + 1 WHERE PRIORITY1 > 16;

UPDATE DOCUMENT_PRIORITY SET PRIORITY1 = 17 WHERE DOCUMENT_TYPE = 12;

UPDATE DOCUMENT_PRIORITY SET PRIORITY1 = 300 WHERE DOCUMENT_TYPE = 6;

UPDATE DOCUMENT_PRIORITY SET PRIORITY1 = 19 WHERE DOCUMENT_TYPE = 6;
UPDATE DOCUMENT_PRIORITY SET PRIORITY1 = 300 WHERE DOCUMENT_TYPE = 8;

ALTER TABLE PART_ITEM ADD PARENT_ID ID_TYPE;
ALTER TABLE PART_ITEM ADD CONSTRAINT PART_ITEM_PARENT_ID_FK1 FOREIGN KEY (PARENT_ID) REFERENCES PART_ITEM;

ALTER TABLE PART_ITEM ADD SPECIFIC_FLAG FLAG_TYPE;

UPDATE PART_ITEM SET SPECIFIC_FLAG = 'N';
